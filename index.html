<!--
three.jsの練習1

three.js


参考
https://www.kabuku.co.jp/developers/threearjs

途中
今のところURLのリンクだけは表示されるが、それ以外は真っ白

THREE.ARUtils.getARDisplay().then(function (display)   
が実行されない



-->

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.ar.js - テンプレテキスト</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no,minimum-scale=1.0, maximum-scale=1.0">
        
        <!-- CSS -->
        <style>

        </style>


        <!-- three.jsのファイルを読み込む(CDNで提供されているURLを使用して導入) 、three.jsはJSのライブラリ-->
        <!-- <script src="https://unpkg.com/three@0.137.4/build/three.min.js"></script> -->
    
        <script>
          window.addEventListener('DOMContentLoaded', init);
          
          //この関数init()の中にThree.jsのコードを書く。
          //initは関数名なのでなんでもいい(上と関数名は合わせる)
          function init() {
    
    
            //下記で作成するレンダラーのサイズを指定
            //幅969px、高さ540px
            const width = 960;
            const height = 540;
    
    
            const renderer = new THREE.WebGLRenderer({
              canvas: document.querySelector('#myCanvas')
            });
            renderer.setPixelRatio(window.devicePixelRatio);
            //レンダラーのサイズをsetSize関数で設定(幅、高さは上記で設定している)
            renderer.setSize(width, height);
    
            //シーン(3Dオブジェクトや光源等を置く3D空間)を作成
            const scene = new THREE.Scene();
    
    
    
            //                                        (画角, アスペクト比)　上記でレンダラーのサイズを設定した値をそのまま使用している
            const camera = new THREE.PerspectiveCamera(45, width / height);
            camera.position.set(0, 0, +1000);
    
    
      
            //                                    (幅, 高さ, 奥行き)
            const geometry = new THREE.BoxGeometry(400, 400, 400);
    
            /*テリアルは色や質感の情報を持っている。
            今回はとりあえず箱を表示させたいので、THREE.MeshNormalMaterialという適当なカラーを割り振るマテリアルを生成する。*/
            const material = new THREE.MeshNormalMaterial();
    
            //                        (ジオメトリ,マテリアル)
            const box = new THREE.Mesh(geometry, material);
    
            //シーンに追加
            scene.add(box);
    
    
            //アニメーション
            /*JavaScriptでアニメーションをさせるには、時間経過で関数を呼び続ける必要がある。
            そのためには、requestAnimationFrame()というグローバルメソッドを使用する。
            requestAnimationFrame()は引数として渡された関数を、毎フレーム実行する。*/
    
            //初回実行
            tick();
    
            // 毎フレーム時に実行されるループイベントです
            function tick() {
    
              //アニメーション処理
              /*アニメーションの処理として、立方体が回転するようにしてみる。
              時間経過で回転するようにrotation.yプロパティの数値を加算する。*/
              box.rotation.y += 0.01;
    
              // レンダリング
              renderer.render(scene, camera); 
    
              //tick関数を毎フレーム実行
              requestAnimationFrame(tick);
            }
          }
        </script>



    </head>




    <body>
       

        <div id="info">
            <span class="title">テンプレテキスト scene</span><br/>
            <span class="links">
            
            <!-- リンクのhtmlタグ "リンク先のURL">アンカーテキスト(左で書いたリンク先のURLがページ上で表示されるとき、このアンカーテキストが代わりに表示される) -->
            <a href="https://github.com/google-ar/three.ar.js">three.ar.jsのサイト</a> -
            <a href="https://developers.google.com/ar/develop/web/getting-started#examples">例</a>
            </span>
        </div>


        <script src="../third_party/three.js/three.js"></script>
        <script src="../third_party/three.js/VRControls.js"></script>
        <script src="../dist/three.ar.js"></script>



        <!-- three.ar.jsのCDN -->
        <script src="https://cdn.jsdelivr.net/npm/three.ar.js@latest/dist/three.ar.js"></script>
        <!-- or  three.ar.jsのCDN  minified バージョン -->
        <script src="https://cdn.jsdelivr.net/npm/three.ar.js@latest/dist/three.ar.min.js"></script>


        <!-- 動かないから追加した -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r127/three.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/r127/examples/js/loaders/GLTFLoader.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/three.js/build/ar.js"></script>



        <!-- JavaScript -->
        <script>

                var vrDisplay, vrControls, arView;
                var canvas, camera, scene, renderer;
                var BOX_DISTANCE = 1.5;
                var BOX_SIZE = 0.25;
                var BOX_QUANTITY = 6;
                var boxesAdded = false;


                



                //アプリケーション開始

                //THREE.ARUtils.getARDisplayを使用してARアプリに使用できるARディスプレイを準備
                /*内部的にはWebVR APIのnavigator.getVRDisplaysを使用してVRディスプレイを取得した後で、
                ディスプレイ名に'tango'または'arkit'が含まれていたらARディスプレイとみなす*/
                THREE.ARUtils.getARDisplay().then(function (display)    //端末判定と表示可否の判定がされ、VRDisplayが呼び出される
                {

                    if (display)    //ARディスプレイが取得できた場合 → ARアプリを実行可能だと判断
                    {   
                        alert('true');
                        vrFrameData = new VRFrameData();    //各オブジェクト準備(VRFrameDataは後ほど端末の位置や向きを取得する際に使用)
                        vrDisplay = display;                //各オブジェクト準備

                        init(); //init関数呼び出し(アプリの初期化)

                    }
                    else          //ARディスプレイが取得無かった場合(ARCode/ARKit非対応のブラウザで開いた場合)
                    {
                        alert('false');
                        THREE.ARUtils.displayUnsupportedMessage();      //画面に警告を表示して終了
                    }
                });





        </script>


 <!-- コンテンツを表示する描画エリア作成(html) -->
 <canvas id="myCanvas"></canvas>
 
    </body>
</html>



